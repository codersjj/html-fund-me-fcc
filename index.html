<!doctype html>
<html lang="en">
  <head>
    <title>Fund Me App</title>
  </head>

  <body>
    Hey, What's good?
    <button id="connectBtn" onclick="connect()">Connect</button>
    <script>
      let isConnected = false

      async function connect() {
        if (typeof window.ethereum !== 'undefined') {
          console.log("I see a metamask!")
          await window.ethereum.request({ method: "eth_requestAccounts" })
          updateButtonText(true)
        } else {
          console.log('No metamask!')
          document.getElementById("connectBtn").innerHTML = "Please install Metamask"
        }
      }

      async function checkConnection() {
        if (typeof window.ethereum !== 'undefined') {
          const accounts = await window.ethereum.request({ method: "eth_accounts" })
          updateButtonText(accounts.length > 0)
        }
      }

      function updateButtonText(isConnect) {
        if (isConnect && isConnected) return
        
        console.log("Updating button text...")

        const button = document.getElementById('connectBtn')
        button.innerHTML = isConnect ? "Connected" : "Connect"
        
        isConnected = isConnect
      }

      window.onload = checkConnection

      window.ethereum.on("accountsChanged", () => {
        console.log("Accounts changed")
        checkConnection()
      })
    </script>
  </body>
</html>
